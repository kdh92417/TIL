# 9. DML: 서브쿼리

## 1. Subquery

> SQL 문 (주로 SELECT 문) 안에 포함되는 SELECT 문.

- 메인쿼리
- 서브쿼리

### 1.1 컬럼 참조의 제한

일반적으로 서브쿼리는 메인쿼리의 컬럼을 참조할 수 있지만, 메인쿼리는 서브쿼리의 컬럼을 참조할 수 없다.
- 단 Inline View(FROM절 서브쿼리)의 경우, 메인 쿼리는 Inline View의 컬럼을 자유롭게 참조 가능

### 1.2 Example

```mysql
SELECT a, b 
FROM 메인테이블 X
WHERE X.a = Y.a  /* Error : 서브쿼리는 메인쿼리에서 참조할 수 없다. */
    AND EXISTS(
        SELECT a, b 
        FROM 서브테이블 Y
        WHERE Y.a = X.a  /* 메인쿼리는 서브쿼리에서 참조할 수 있다. */
    );
```

### 1.3 ORDER BY 절 사용의 제한
- WHERE 절 서브쿼리에서는 ORDER BY 절을 사용하지 못한다.

<br>

## 2. WHERE 절 서브쿼리

### 반환되는 결과의 형태에 따른 분류 (연산자에 따른 분류)

- 단일값 서브쿼리 (scalar subquery) : 단일값 비교연산자(`=`, `<>`, `<`, `<=`, `>=`)
- 다중값 서브쿼리 (column subquery) : 단일값 비교연산자(`=`, `<>`, `<`, `<=`, `>=`), 한정자(`ANY`, `SOME`, `ALL`)
- 다중행 서브쿼리 (table subquery) : 멤버쉽 연산자(`IN`), 존재 정량자(`EXISTS`)
  - EXISTS: 서브쿼리의 결과를 만족하는 투플의 존재여부 확인, 존재를 확인하는 투플을 1개라도 찾는다면 검색을 멈춘다.

### 동작하는 방식에 따른 분류
- 비연관 서브쿼리
  - 서브쿼리가 메인쿼리 컬럼을 가지고 있지 않은 형태
  - 서브쿼리는 한번 실행
  - 메인쿼리에 서브쿼리 결과를 제공

- 연관 서브쿼리
  - 서브쿼리가 메인쿼리 컬럼을 가지고 있는 형태
  - 메인쿼리의 투플마다 서브쿼리가 반복 실행(nested loop와 유사)
  - 메인쿼리 테이블을 필터링






